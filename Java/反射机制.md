[TOC]



# 反射

## 简介

反射能够在**程序运行时**动态访问类相关的内容。

功能：

* 获取对象所属的类
* 构造对象
* **获取**和**调用**类或实例的**变量**和**方法**

缺点：额外消耗系统资源，可能会破坏封装性

使用场景：

* 动态代理
* spring加载配置文件
* jdbc连接数据库
* IDEA的代码提示

## 使用

### 获取Class对象

* 通过对象实例`instance.getClass()`获取
* 通过对任意类型`T`调用`T.class`获取
* 通过 `Class.forName()`传入类的路径获取
* 通过类加载器`ClassLoader.loadClass()`传入类路径获取

例：

```java
Class<?> clz = Class.forName("com.reflect.Apple");
```

### 构造对象

* 直接调用Class对象的`newInstance()`方法，只能构造无参数的对象

  ```java
  Object object =  clz.newInstance();
  ```

* 先构造`Constructor`对象，再调用该对象的`newInstance()`方法

  ```java
  Constructor constructor = clz.getConstructor();
  Object object = constructor.newInstance();
  ```

### 获取方法和字段

注意：==如要访问私有字段或方法需要调用`setAccessible(true)`==

* 获取方法的方法

  ![image-20210513210920560](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210513210920.png)

* 获取字段的方法

  ![image-20210513211315552](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210513211315.png)

  方法名不包含 `Declared `的方法只返回被`public`修饰的数据，而包含 `Declared `的方法可以获取所有的数据。

* 调用对象的方法
  第一次参数是调用方法的对象，后面的参数是方法的输入参数
  
  ![image-20210513212243949](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210513212243.png)

```
public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException {
    Class<?> c = Class.forName("test.Person");
    Constructor<?> constructor = c.getDeclaredConstructor(int.class);
    Object obj = constructor.newInstance(5);

    Method getAge = c.getDeclaredMethod("getAge");
    System.out.println(getAge.invoke(obj));

    Field age = c.getDeclaredField("age");
    System.out.println(age.get(obj));
    
```

# 参考资料

* [深入解析 Java 反射（1）- 基础](http://www.sczyh30.com/posts/Java/java-reflection-1/)

