# Overview
数据链路层提供帧间的逻辑通信服务。
类型：
* 点对点信道：也就是字面意思，点对点得通信方式。
* 广播信道：这种信道是一对多的方式，所以整个过程也比较复杂。必须使用一些信道协议来协调网络中的主机数据发送。在半双工通信中有[CSMA](#CSMA)等协议。

数据链路层主要有两个功能：
* 差错检测：使用**循环冗余检验**（CRC）来检查数据传输过程中是否产生比特差错
* 流量控制：采用**滑动窗口机制**

## 封装帧
将[网络层](网络层.md)传下来的分组前后分别添加首部和尾部，这样就构成了帧。

![](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210424143312.png)
透明传输：帧使用首部和尾部进行定界。如果帧的数据部分含有和首部和尾部相同的内容，需要插入转义字符。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。

# MAC
确认网络设备位置的位址。
由48位二进制数组成。一般用12个16进制数代表：
![](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210424143311.png)

# CSMA
CSMA(Carrier Sense Multiple Access): 载波侦听多路访问，**用于半双工通信**。
## 分类
LBT机制:
* 1-persistent CSMA：当要发送帧的设备侦听到线路忙或发生碰撞时，会持续侦听；若发现不忙则立即发送。当传播延迟较长或多个设备同时发送帧的可能性较大时，此策略会导致较多的碰撞，导致性能降低。
* non-persistent CSMA：当要发送帧的设备侦听到线路忙或发生碰撞时，会随机等待一段时间再进行发送；此策略可以减少碰撞，但会导致信道利用率降低，以及较长的延迟。
* p-persistent CSMA：当要发送帧的设备侦听到线路忙或发生碰撞时，会持续侦听；若发现不忙，则**<u>以概率p发送帧，概率1-p继续侦听</u>**。

## CSMA/CD
CSMA/CD(Carrier Sense Multiple Access with Collision Detection): 设备在发送帧的同时要对信道进行侦听，以确定是否发生碰撞，若在发送数据过程中检测到碰撞，则进行如下碰撞处理操作：

1. 立即停止发送数据并发送**<u>特殊阻塞信息</u>**强化碰撞，使得其它设备能尽快检测到碰撞发生。
2. 执行**二进制指数避退算法**重传

	>1. 从[0， $2^{(k-1)}$ ]从随机选择一个数R，（k=Min[重传次数，10]）
	>2. 重传时间为 2T * R（T为单程端到端的传播时延）

---

* 最短帧的长度为**<u>64字节</u>**：避免检测到冲突时，数据帧已经传送完毕，无法被撤回。
* 最长帧的长度为**<u>1500字节</u>**(MTU, Maximum Transmission Unit)：避免长时间占用信道或者发送数据超出接收端缓冲区大小。

## CSMA/CA
无线局域网在半双工通信下会遇到以下问题：
![](https://raw.githubusercontent.com/cluckl/Pinnned-repo/master/img/20210424143313.png)
为了缓解该问题，一般使用CSMA/CA协议。CSMA/CA协议主要使用两种方法来避免碰撞：
1. 帧听到通道空闲时，维持一段帧间隔时间IFS (InterFrame Space)后，再等待一段随机的时间依然空闲时，才提交。
	>* SIFS，短帧间间隔，如ACK帧、CTS帧
	>* DIFS，分布协调功能帧间间隔
2. RTS-CTS三向握手：设备欲发送帧前，先发送一个很小的RTS帧给最近的AP，等待目标端回应CTS帧后，才开始发送。

过程：当信道为空的时候，首先等待一个帧间间隔，之后再监听信道，如果还为空，那么开始执行回退机制，回退机制之后，再次监听，如果还为空，那么就开始发送。
### 回退机制：
竞争窗口（Contention Window）大小 = $2^{(k -1)}$
1. 若传输成功，则k减1。
2. 若发生冲突后，在1~6次中，k加1翻倍，第6次时，窗口大小不变，若第7次传输失败，则进行丢包处理。

后退时间= randomT * 单位时间，randomT是从（0，Cw）中的一个随机数。

# Reference
* [802.11协议精读3：CSMA/CD与CSMA/CA - 知乎](https://zhuanlan.zhihu.com/p/20731045)
* [CSMA/CD协议详解！！！_loveCC_orange的博客-CSDN博客](https://blog.csdn.net/loveCC_orange/article/details/79177129)
* [CSMA/CA协议详解【计算机网络】_周末参见-CSDN博客](https://blog.csdn.net/qq894040717/article/details/82426965)
* [载波侦听多路访问- 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/%E8%BD%BD%E6%B3%A2%E4%BE%A6%E5%90%AC%E5%A4%9A%E8%B7%AF%E8%AE%BF%E9%97%AE)
* [802.11的CSMA/CA机制_hanzhen7541的博客-CSDN博客](https://blog.csdn.net/hanzhen7541/article/details/79024068)
* [【计算机网络】你真的理解数据链路层吗？ - 知乎](https://zhuanlan.zhihu.com/p/69554474)
* [数据链路层上的三个基本问题](https://leetcode-cn.com/leetbook/read/networks-interview-highlights/e4ppa6/)